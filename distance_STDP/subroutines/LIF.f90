!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!                  LEAKY INTEGRATE-AND-FIRE NEURON                           !!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
	SUBROUTINE lif()
	USE PARAMETERS
	USE VARIABLES
	USE IFPORT
	IMPLICIT NONE
	REAL*8		::	g_tot,u_inf,tau_eff,decay
!======================== resetting spike variable to NO spike ============================!
	spk_post = .FALSE.
!============= calculation of membrane potential if not in refrac period ==================!
	IF((tr-spkt_post).GT.p_ne(3)) THEN
	!-------------------------- NMDA gating variable ------------------------------------------!
		x(8) = 1.0d0/(1.0d0+p_syn(6)*EXP(p_syn(7)*x(1)))
	!------------------------------------------------------------------------------------------!
	!---------------------------- total conductance -------------------------------------------!
		g_tot = 1.0d0 + x(3) + x(6)*x(8) + x(4) + x(2)*p_ne(7)
	!------------------------------------------------------------------------------------------!
	!------------------------------- u infinity -----------------------------------------------!
		u_inf = (p_ne(2) + x(4)*p_syn(2) + x(2)*p_ne(7)*p_ne(6) )/g_tot
	!------------------------------------------------------------------------------------------!
	!-------------------------------- tau effective) ------------------------------------------!
		tau_eff = p_ne(1)/g_tot
	!---------------------------- e^(-dt/tau effective) ---------------------------------------!
	!------------------------------------------------------------------------------------------!
		decay = DEXP(-1.0d0*dt/tau_eff)
	!------------------------------------------------------------------------------------------!
	!------------------------------- membrane potential ---------------------------------------!
		x(1) = x(1)*decay + u_inf*(1.0d0-decay) + x(14)
	!------------------------------- action potential -----------------------------------------!
		IF(x(1).GE.p_ne(4)) THEN
			spkt_post = tr			!spike timing
			spk_post = .TRUE.		!spike
			x(1) = p_ne(9)			!reset
			x(2) = x(2) + 1.0d0		!AHP conductance increase
		END IF
	!------------------------------------------------------------------------------------------!
	END IF
!==========================================================================================!
!=========================== update of synaptic conductances ==============================!
	!decay of AHP conductance
	x(2) = x(2)*p_ne(10)
	!decay of AMPA conductance
	x(3) = x(3)*p_syn(3)
	!decay of GABA_A conductance
	x(4) = x(4)*p_syn(4)
	!decay of NMDA conductance
	x(6) = x(6)*p_syn(5)
!==========================================================================================!
!========================== codependent plasticvity variables =============================!
	!E
	exc_pre_cond(1:ne_input) = exc_pre_cond(1:ne_input)*p_syn(5) - DBLE(spk(1:ne_input))*msynw(1:ne_input)	!excitatory conductance for each synapse
	exc_pre(1:ne_input) = exc_pre(1:ne_input)*p_plast(31) - exc_pre_cond(1:ne_input)*x(8)*x(1)*p_plast(32)	!excitatory current trace for each synapse
!==========================================================================================!
	END SUBROUTINE
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
