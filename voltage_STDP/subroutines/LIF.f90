!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!                  LEAKY INTEGRATE-AND-FIRE NEURON                           !!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
	SUBROUTINE lif()
	USE PARAMETERS
	USE VARIABLES
	USE IFPORT
	IMPLICIT NONE
	REAL*8		::	g_tot,u_inf,tau_eff,decay
!========================== calculation of membrane potential =============================!
	!-------------------------- NMDA gating variable ------------------------------------------!
		x(8) = 1.0d0/(1.0d0+p_syn(6)*EXP(p_syn(7)*x(1)))
	!------------------------------------------------------------------------------------------!
	!---------------------------- total conductance -------------------------------------------!
		g_tot = 1.0d0 + x(3) + x(6)*x(8) + x(4) + x(2)*p_ne(7) + x(11)
	!------------------------------------------------------------------------------------------!
	!------------------------------- u infinity -----------------------------------------------!
		u_inf = (p_ne(2) + x(4)*p_syn(2) + x(2)*p_ne(7)*p_ne(6) + x(12) + x(11)*p_ne(12))/g_tot
	!------------------------------------------------------------------------------------------!
	!-------------------------------- tau effective) ------------------------------------------!
		tau_eff = p_ne(1)/g_tot
	!---------------------------- e^(-dt/tau effective) ---------------------------------------!
	!------------------------------------------------------------------------------------------!
		decay = DEXP(-1.0d0*dt/tau_eff)
	!------------------------------------------------------------------------------------------!
	!------------------------------- membrane potential ---------------------------------------!
		x(1) = x(1)*decay + u_inf*(1.0d0-decay)
	!------------------------------- action potential -----------------------------------------!
		IF(spk_post) THEN
			spkt_post = tr			!spike timing
			x(2) = x(2) + 1.0d0		!AHP conductance increase
			x(11) = x(11) + ca_amp		!bAP conductance increase
		END IF
	!------------------------------------------------------------------------------------------!
!==========================================================================================!
!=========================== update of synaptic conductances ==============================!
	!decay of AHP conductance
	x(2) = x(2)*p_ne(10)
	!decay of AMPA conductance
	x(3) = x(3)*p_syn(3)
	!decay of GABA_A conductance
	x(4) = x(4)*p_syn(4)
	!decay of NMDA conductance
	x(6) = x(6)*p_syn(5)
	!decay of calcium conductance
	x(11) = x(11)*p_ne(11)
!==========================================================================================!
!========================== codependent plasticvity variables =============================!
	!E
	x(18) = x(18)*p_plast(31) - x(6)*x(8)*x(1)*p_plast(32)
!==========================================================================================!
	END SUBROUTINE
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
