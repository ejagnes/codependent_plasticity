	SUBROUTINE lif()
	USE PARAMETERS
	USE VARIABLES
	USE IFPORT
	IMPLICIT NONE
!===================================== SOMA  ==============================================!
!------------------------ resetting spike variable to NO spike ----------------------------!
	spk_post = .FALSE.
!------------------------------------------------------------------------------------------!
!------------- calculation of membrane potential if not in refrac period ------------------!
	IF((tr-spkt_post).GT.pr(3)) THEN
	!---------------------------- total conductance -------------------------------------------!
		x(21) = 1.0d0/(1.0d0 + x(2)*pr(7) + 2.0d0*pr(197))
	!------------------------------------------------------------------------------------------!
	!------------------------------- u infinity -----------------------------------------------!
		x(22) = ( pr(2) + x(2)*pr(7)*pr(6) + pr(197)*(xd(1)+xdb(1)) )*x(21)
	!------------------------------------------------------------------------------------------!
	!---------------------------- e^(-dt/tau effective) ---------------------------------------!
		x(23) = DEXP(pr(1)/x(21))
	!------------------------------------------------------------------------------------------!
	!------------------------------- membrane potential ---------------------------------------!
		x(1) = x(1)*x(23) + x(22)*(1.0d0-x(23))
	!------------------------------------------------------------------------------------------!
	!------------------------------- action potential -----------------------------------------!
		IF(x(1).GE.pr(4)) THEN
			spkt_post = tr			!spike timing
			spk_post = .TRUE.		!spike
			x(1) = pr(9)			!reset
			x(2) = x(2) + 1.0d0		!AHP conductance increase
		END IF
	END IF
	!------------------------------------------------------------------------------------------!
!------------------------------------------------------------------------------------------!
!---------------------------- decay of AHP conductance ------------------------------------!
	x(2) = x(2)*pr(10)
!------------------------------------------------------------------------------------------!
!==========================================================================================!
!=================================== DENDRITE 1 ===========================================!
!-------------------------- NMDA gating variable ------------------------------------------!
	xd(8) = 1.0d0/(1.0d0+pr(38)*EXP(pr(39)*xd(1)))
!------------------------------------------------------------------------------------------!
!---------------------------- total conductance -------------------------------------------!
	xd(21) = 1.0d0/(1.0d0 + xd(3) + xd(6)*xd(8) + xd(4) + pr(197))
!------------------------------------------------------------------------------------------!
!------------------------------- u infinity -----------------------------------------------!
	xd(22) = (pr(2) + xd(4)*pr(32) + pr(197)*x(1))*xd(21)
!------------------------------------------------------------------------------------------!
!---------------------------- e^(-dt/tau effective) ---------------------------------------!
	xd(23) = DEXP(pr(1)/xd(21))
!------------------------------------------------------------------------------------------!
!------------------------------- membrane potential ---------------------------------------!
	xd(1) = xd(1)*xd(23) + xd(22)*(1.0d0-xd(23))
!------------------------------------------------------------------------------------------!
!--------------------------- update of synaptic conductances ------------------------------!
	!decay of AMPA conductance
	xd(3) = xd(3)*pr(35)
	!decay of GABA_A conductance
	xd(4) = xd(4)*pr(36)
	!decay of NMDA conductance
	xd(6) = xd(6)*pr(37)
!------------------------------------------------------------------------------------------!
!==========================================================================================!
!=================================== DENDRITE 2 ===========================================!
!-------------------------- NMDA gating variable ------------------------------------------!
	xdb(8) = 1.0d0/(1.0d0+pr(38)*EXP(pr(39)*xdb(1)))
!------------------------------------------------------------------------------------------!
!---------------------------- total conductance -------------------------------------------!
	xdb(21) = 1.0d0/(1.0d0 + xdb(3) + xdb(6)*xdb(8) + xdb(4) + pr(197))
!------------------------------------------------------------------------------------------!
!------------------------------- u infinity -----------------------------------------------!
	xdb(22) = (pr(2) + xdb(4)*pr(32) + pr(197)*x(1))*xdb(21)
!------------------------------------------------------------------------------------------!
!---------------------------- e^(-dt/tau effective) ---------------------------------------!
	xdb(23) = DEXP(pr(1)/xdb(21))
!------------------------------------------------------------------------------------------!
!------------------------------- membrane potential ---------------------------------------!
	xdb(1) = xdb(1)*xdb(23) + xdb(22)*(1.0d0-xdb(23))
!------------------------------------------------------------------------------------------!
!--------------------------- update of synaptic conductances ------------------------------!
	!decay of AMPA conductance
	xdb(3) = xdb(3)*pr(35)
	!decay of GABA_A conductance
	xdb(4) = xdb(4)*pr(36)
	!decay of NMDA conductance
	xdb(6) = xdb(6)*pr(37)
!------------------------------------------------------------------------------------------!
!==========================================================================================!
!========================== CODEPENDENT PLASTICITY VARIABLES ==============================!
	!E
	x(18) = x(18)*p_plast(31) - xd(6)*xd(8)*xd(1)*p_plast(32)
	!I
	x(19) = x(19)*p_plast(34) + xd(4)*(xd(1)-pr(32))*p_plast(35)
	!E-alpha*I
	x(17) = p_plast(26)*(x(18)*(x(18) - x(19)*p_plast(25)))
!==========================================================================================!
	END SUBROUTINE
